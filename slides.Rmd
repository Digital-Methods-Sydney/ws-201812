---
title: "Topic models in R"
author: "Francesco Bailo (francesco.bailo@sydney.edu.au)"
date: "5 December 2018 (updated: `r format(Sys.Date(), '%d %B %Y')`)"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts, "footer.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false

---

layout: true

<div class="my-footer"><span>@FrBailo    
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href = "mailto:francesco.bailo@sydney.edu.au">francesco.bailo@sydney.edu.au</a></span></div> 

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(tidyverse)
library(kableExtra)
library(knitr)
```

---
class: center, middle

Digital Methods @ The University of Sydney

```{r, out.width='45%', fig.align='center', echo = FALSE}
knitr::include_graphics('https://github.com/Digital-Methods-Sydney/ws-201806/raw/master/img/digital-methods-logo.png')
```

**Code** and **Data** are available [here](https://github.com/Digital-Methods-Sydney/ws-201806). 

---
# Setting up

If you are using [RStudio](https://www.rstudio.com/products/rstudio/#Desktop) (and you should!), download the zip archive of the entire repository ([github.com/Digital-Methods-Sydney/ws-201812/archive/master.zip](https://github.com/Digital-Methods-Sydney/ws-201812/archive/master.zip)), uncompress the archive file `ws-201808-master.zip` and open `ws-201812.Rproj` with RStudio to load the project.

You can open the R scripts by navigating the project folders in the **FILES** region of RStudio.

```{r, out.width='65%', fig.align='center', echo = FALSE}
knitr::include_graphics('img/rstudio-ui.svg')
```

---

# Getting to know each other: a Quiz

1. Visit socrative.com
2. Login as `student` in the room `TOPICMODELS`.
3. Respond to the first question:

**In R, how do you get the column names of a data frame called "dataset"?**

---

# A one-slide introduction to 

```{r, out.width='15%', fig.align='center', echo = FALSE}
knitr::include_graphics('img/r_logo.svg')
```

R is an *object-oriented* programming language. This means that everything in a R is an **object**. 

Most of the objects can be broadly categorised either as
* **Values** (or variables) `my_data <- 6`, or as 
* **Functions** `my_function <- function(data){data + 1}`.

Each values is an object of a specific *class*. 

```{r}
my_data <- 6
class(my_data)
```

**Functions** accept objects of some *class* and return objects of some (but not necessary the same) *class*. 

---

# A one-slide introduction to

<div align="center" ><h2 style="font-size:200%;">tidy data in <img src="img/r_logo.svg" width="120"></h2></div>

Accordingly (see [tidyr.tidyverse.org](https://tidyr.tidyverse.org/)),

```{r, echo=FALSE}
not_tidy_data <- 
  tibble(country = c('A', 'B', 'C'),
         `1999` = c('0.7K', '37K', '212K'),
         `2000` = c('2K', '80K', '213K'))
```


```{r, echo=F}
kable(gather(not_tidy_data, "1999", "2000", key="year", value="cases"), caption = 'Tidy data') %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "float_right")

kable(not_tidy_data, caption = 'Not tidy data', format = 'html') %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "float_right")
```


> Tidy data is data where:
> 
> 1. Each variable is in a column.
> 2. Each observation is a row.
> 3. Each value is a cell.

---
# magrittr: R code with pipes (%>%)

```{r, echo=F}
kable(iris[1:3,])
```

```{r}
iris %>%
  group_by(Species) %>%
  summarize(Average.Petal.Length = mean(Petal.Length))
```

```{r, out.width='15%', fig.align='center', echo = FALSE}
knitr::include_graphics('img/magritte-pipe.svg')
# Artwork by dan lowenstein, IL
```

---
# Text analysis in R: A Workflow

1. Import your data
2. Tidy your data
3. Model your data
4. Present your results

---

# Importing

Let's first import some textual data into R from PDFs, webpages and XML documents and an API.

---

# Import PDF

```{r}
read_chunk("script/01-importing/import_pdf.R")
```

```{r import_pdf, eval = FALSE}

```

---

# Import HTML

## Xpath

> XPath can be used to navigate through elements and attributes in an XML[-like] document (see [www.w3schools.com/xml/xml_xpath.asp](https://www.w3schools.com/xml/xml_xpath.asp)).

```{html}
<!DOCTYPE html>
  <html>
    <body>
  
    <h1>My First Heading</h1>
  
    <div class='foo'><p>My first paragraph.</p></div>
  
    </body>
  </html>
```

The xpath `//div[@class='foo']/p` will get you this: `<p>My first paragraph.</p>`. (And you can check this [here](http://xpather.com/A4yx3Gsx))

---

# Import HTML

```{r}
read_chunk("script/01-importing/import_html.R", from = 1, to = 18)
```

```{r import_html1, eval = FALSE}

```

---

# Import HTML

```{r import_html2, eval = FALSE}

```

---

# Import HTML

```{r import_html3, eval = FALSE}

```

---

# Hands-on

Visit this page: [imdb.com/title/tt0057012/](https://imdb.com/title/tt0057012/)

---

# Import XML

```{r}
read_chunk("script/01-importing/import_xml.R")
```

```{r import_xml, eval = FALSE}

```

---

# APIs

An API (or **A**pplication **P**rogramming **I**nterface) makes it easier for a computer to communicate with another computer. Many public web APIs are available: they offer programmatic access to data resources of an enterprise. For example, the research on large Facebook and Twitter datasets is usually conducted on data collected after a request to the Facebook API (graph.facebook.com) and the Twitter API (api.twitter.com).

Wikipedia also has a [public API](http://en.wikipedia.org/w/api.php). And we can submit a request by concatenating different options in a single string (which you can actually enter into the address bar of your browser).

---

# APIs

```{r echo = FALSE}
api_tibble <- 
  tibble(parameter = c("http://en.wikipedia.org/w/api.php?",
                       "action=query",
                       "&format=json",
                       "&prop=revisions", 
                       "&rvprop=content",
                       "&rvsection=0",
                       "&titles=pizza"),
         description = c("Base URL",
                         "Which action to perform",
                         "The format of the output",
                         "Which properties to get for the queried pages",
                         "Which properties to get for each revision",
                         "Only retrieve the content of this section number",
                         "A list of titles to work on"))
knitr::kable(api_tibble, format = "html")
```

Ane let's concatenate everything together: 

http://en.wikipedia.org/w/api.php?action=query&format=json&prop=revisions&rvprop=content&rvsection=0&titles=pizza

---

# Import API

```{r}
read_chunk("script/01-importing/import_api.R")
```

```{r import_api, eval = FALSE}

```

---

# Cleaning

---

# Preparing

---

# Modelling

---

# Evaluating

---

# Visualising

---

# Reporting
